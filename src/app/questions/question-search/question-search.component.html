<form [formGroup]="searchForm" class="sticky-top bg-white p-3" (ngSubmit)="onSubmit()" novalidate>
  <div class="form-group mb-0" style="position:relative">
    <input id="search-box" class="form-control mb-2 rounded-0 px-3" #searchBox formControlName="search"
            autocomplete="off"
            (keyup.enter)="searchBox.blur()"
            (keyup)="searchTags(searchBox.value, searchBox.selectionEnd)"
            (click)="searchTags(searchBox.value, searchBox.selectionEnd)" />
      <ul [hidden]="(tags | async)?.length == 0" id="live-suggest" class="list-unstyled bg-white text-muted border border-light w-100">
        <li *ngFor="let tag of tags$ | async"
            (click)="onSelectTag(searchBox.value, searchBox.selectionEnd, tag.name); searchBox.focus();"
            class="d-flex justify-content-between px-3">
          <div>{{tag.name}}</div>
          <div class="ml-5">{{tag.question_count}}</div>
        </li>
      </ul>
  </div>
  <div class="d-flex justify-content-between text-uppercase">
    <a [routerLink]="'/questions/new'">New Question</a>
    <div class="text-muted" (click)="toggleFilters()">
      Search Filters
      <span class="oi oi-magnifying-glass"></span>
    </div>
  </div>
  <small class="d-block text-muted">{{(questions$ | async)?.count}} Results</small>
  <div [hidden]="!showFilters">
    TODO: filters
  </div>
</form>

<!-- search results -->
<div *ngIf="(questions$ | async)?.results">
  <ul class="list-group mb-3">
    <li *ngFor="let question of (questions$ | async)?.results"
        class="list-group-item list-group-item-action flex-column align-items-start border-0 rounded-0">
      <div class="d-flex w-100 justify-content-between">
        <small class="text-muted">
          <a [routerLink]="['/questions', question.id]">#{{question.id}}</a> &middot;
          <a [routerLink]="['/users', question.created_by]">{{question.created_by}}</a> &middot;
          <span>{{question.created_on | age}}</span>
          </small>
        <a class="px-1"><span class="oi oi-ellipses text-primary" aria-hidden="true"></span></a>
      </div> <!-- ./d-flex -->
      <p class="link mb-0" (click)="question.showAnswer = !question.showAnswer">
        <span>{{question.text}}</span>
        <span *ngIf="question.showAnswer" class="text-success">{{question.answer}}</span>
      </p>
    </li> <!-- ./list-group-item -->
  </ul>

  <ngb-pagination class="d-flex justify-content-center" (pageChange)="onPageChange($event)"
                  [collectionSize]="count" [page]="page" [pageSize]="pageSize"
                  [maxSize]="5" [rotate]="true" [ellipses]="false"></ngb-pagination>
</div>